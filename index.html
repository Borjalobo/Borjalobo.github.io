<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.7.1.js"
        integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <title>Document</title>
</head>

<body>
    <div style="background-color: #07204A; margin-top: 150px; border-radius: 10px; color:white" class="container">
        <p>hola</p>
        <div id="partes" class='card mb-1'>
            <p class="fs-3">Iniciar un parte</p>
            <div id="abrirParte" class='card mb-1'>
                <button type="button" class="btn btn-primary btn-block" id='iniciar'
                    style="background-color: red;">Iniciar
                    Parte üßæ</button>
                <div id="zonaFirma" class='zonas'>

                    <div id='firma' class="fondoFirma"></div>
                    <input type="text" id='firmaInput' hidden>
                    <div id="opcionesFirma" class='m-1'>
                        <div class="row">
                            <div class="col-4">
                                <div class="btn btn-sm btn-secondary" id="borraFirma">üöÆ Borrar</div>
                            </div>
                            <div class="col-8">
                                <div class="btn btn-success d-md-block" id="enviar">Enviar</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="cerrarParte" class='card mb-1'>
                <button type="button" class="btn btn-danger btn-block" id='parar'>Cerrar Parte üèÉ‚Äç‚ôÄÔ∏è</button>
            </div>
        </div>


        <div id="break" class='card mb-1'>
            <p class="fs-3">Break</p>
            <button type="button" class="btn btn-outline-danger btn-block mb-1" id='break'>Parada parcial <span
                    class="fas fa-utensils"></span></button>
        </div>

        <div id="nfc" class='card mb-1'>
            <button type="button" class="btn btn-primary btn-block" id='iniciar'>Registrar el dispositivo para
                NFC</button>
        </div>

        <!-- Botones para leer y escribir 
        <button onclick="startNFCReading()">Iniciar Lectura NFC</button>
        <button onclick="writeNFCData()">Escribir Datos NFC</button>-->

        <!-- Espacio para mostrar resultados 
        <div id="result">mmmmm</div>-->

    </div>

    <script>
        $(document).ready(function () {

            if ('NDEFReader' in window) {
                alert("La API NFC est√° disponible en este navegador 1648.");
                navigator.permissions.query({ name: 'nfc' })
                    .then(permissionStatus => {
                        if (permissionStatus.state === 'granted') {
                            alert("El usuario ya ha concedido permisos para acceder al NFC");

                            // El usuario ya ha concedido permisos para acceder al NFC
                            // Puedes inicializar el NDEFReader aqu√≠
                            initializeNFCReader();
                        } else if (permissionStatus.state === 'prompt') {
                            // El usuario a√∫n no ha decidido, muestra un mensaje o una solicitud de permisos
                            // y maneja la respuesta del usuario
                            alert("El usuario a√∫n no ha decidido");
                            permissionStatus.onchange = () => {
                                if (permissionStatus.state === 'granted') {
                                    // El usuario ha concedido permisos
                                    alert("El usuario ha concedido permisos");
                                    initializeNFCReader();
                                } else {
                                    // El usuario ha denegado permisos
                                    alert('El usuario ha denegado los permisos para acceder al NFC.');
                                }
                            };
                        } else {
                            // El usuario ha denegado expl√≠citamente los permisos
                            alert('El usuario ha denegado los permisos para acceder al NFC.');
                        }
                    })
                    .catch(error => {
                        alert('Error al solicitar permisos NFC:', error);
                    });
            } else {
                alert('El navegador no es compatible con la API NDEFReader. 1717');
            }

            function initializeNFCReader() {
                const reader = new NDEFReader();

                // Escuchar eventos de lectura NFC
                reader.addEventListener('reading', ({ message, serialNumber }) => {
                    // Mostrar los datos le√≠dos
                    //document.getElementById('result').innerHTML = `<p>Datos le√≠dos:</p><pre>${JSON.stringify(message, null, 2)}</pre>`;
                    //document.getElementById('result').innerHTML = "hola";
                    alert(message);

                });

                // Iniciar la lectura NFC
                reader.scan();

                // Mostrar mensaje de inicio de lectura
                document.getElementById('result').innerHTML = '<p>Escaneando etiquetas NFC...</p>';
            }

            function showPermissionDialog(permissionStatus) {
                // Mostrar un mensaje o un di√°logo que explique por qu√© se necesita acceso al NFC
                // y proporcionar opciones para que el usuario conceda o deniegue los permisos
                // Por ejemplo:
                const permissionDialog = document.createElement('div');
                permissionDialog.innerHTML = `
    <p>Esta aplicaci√≥n necesita acceder al NFC para funcionar correctamente.</p>
    <button id="grantPermission">Permitir</button>
    <button id="denyPermission">Denegar</button>
  `;
                document.body.appendChild(permissionDialog);

                // Manejar los clics en los botones de permisos
                document.getElementById('grantPermission').addEventListener('click', () => {
                    permissionStatus.onchange = () => {
                        if (permissionStatus.state === 'granted') {
                            // El usuario ha concedido permisos
                            initializeNFCReader();
                            alert("El usuario ha concedido permisos");
                        } else {
                            // El usuario ha denegado permisos
                            alert('El usuario ha denegado los permisos para acceder al NFC.');
                        }
                    };
                    permissionStatus.resolve('granted');
                    document.body.removeChild(permissionDialog);
                });

                document.getElementById('denyPermission').addEventListener('click', () => {
                    permissionStatus.onchange = () => {
                        console.log('El usuario ha denegado los permisos para acceder al NFC.');
                    };
                    permissionStatus.resolve('denied');
                    document.body.removeChild(permissionDialog);
                });
            }




        });





    </script>

</body>

</html>